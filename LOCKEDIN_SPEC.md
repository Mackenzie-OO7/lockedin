# LockedIn - Complete Project Specification

## ğŸ¯ Project Overview

**Name:** LockedIn
**Tagline:** "Get LockedIn to financial discipline"
**Purpose:** Time-locked bill payment vault with automatic scheduling on Stellar blockchain
**Timeline:** 4 days (hackathon build)
**Tech Stack:** Rust (Soroban), TypeScript, React, Vite, Stellar SDK, Scaffold Stellar

---

## âš ï¸ CRITICAL HACKATHON REQUIREMENT - READ FIRST

**THIS PROJECT MUST BE BUILT AS A SCAFFOLD STELLAR PROJECT**

**Hackathon Category:**
> "Develop new smart contracts for specialized needs and **easily integrate them with the provided structure**, generating clients and managing their deployment through the environment configuration files."

### **What This Means:**
1. âœ… Initialize with `stellar scaffold init lockedin`
2. âœ… Work WITHIN Scaffold's provided structure
3. âœ… Use Scaffold's auto-generated TypeScript clients
4. âœ… Follow Scaffold's existing frontend patterns (like their debugger)
5. âœ… Deploy using `environments.toml` configuration
6. âœ… Import contracts like: `import vault from './contracts/lockedin'`

### **DO NOT:**
- âŒ Over-engineer with custom tooling
- âŒ Create architecture outside Scaffold's structure
- âŒ Build a separate framework on top of Scaffold
- âŒ Ignore Scaffold's conventions

### **DO:**
- âœ… Add ONE custom smart contract (`contracts/lockedin/`)
- âœ… Enhance UI following Scaffold's component patterns
- âœ… Use Scaffold's wallet integration hooks
- âœ… Show how easy it is to build with Scaffold

**Remember:** The judges want to see Scaffold Stellar's power, not a complex custom framework.

---

## ğŸ“‹ Core Concept

LockedIn is a smart contract-based bill payment system that:
1. Locks USDC funds for a specified period (1-12 months)
2. Automatically returns funds to user's wallet when bills are due
3. Returns any surplus at the end of the period
4. Enforces financial discipline through time-locks and withdrawal restrictions

**Key Innovation:** You can't withdraw early - money only comes out when bills are due or at period end.

---

## ğŸ—ï¸ System Architecture

### **Components:**
1. **Smart Contract (Rust/Soroban)** - Core logic, fund custody, bill scheduling
2. **Frontend (React + TypeScript)** - User interface, wallet integration
3. **TypeScript Client** - Auto-generated by Scaffold Stellar
4. **Keeper Service (Node.js)** - Cron job for automatic bill payments
5. **Email Service (SendGrid)** - Notifications and summaries

---

## ğŸ” Security Requirements

### **Must Haves:**
- âœ… Audited patterns from OpenZeppelin Stellar contracts
- âœ… Time-lock mechanisms (no early withdrawals)
- âœ… Access control (admin functions protected)
- âœ… Reentrancy guards
- âœ… Integer overflow protection (Rust handles this)
- âœ… Input validation on all parameters
- âœ… Event emission for all state changes

### **Security Considerations:**
- Anti-gaming mechanisms (30-day minimum lead time)
- Emergency bill limits (10% of funds)
- Monthly adjustment limits (prevents abuse)
- Fee percentage caps (1-5%)

---

## ğŸ’° Token Standard

**Currency:** USDC on Stellar (stablecoin only)
**Contract Address:** Will use Stellar's native USDC token

---

## ğŸ“Š Data Structures

### **BillCycle**
```rust
pub struct BillCycle {
    id: u64,
    owner: Address,              // Wallet that created the cycle
    start_date: u64,             // Unix timestamp
    end_date: u64,               // Unix timestamp (max 12 months)
    total_deposited: i128,       // Total USDC deposited
    total_allocated: i128,       // Sum of all bills
    total_spent: i128,           // Sum of paid bills
    fee_percentage: u32,         // 100 = 1%, 500 = 5%
    fee_paid: i128,              // Operating fee paid to admin
    last_adjustment_month: u32,  // Year-month (e.g., 202501 = Jan 2025)
    adjustment_used: bool,       // Did they adjust this month?
    is_closed: bool,             // Has cycle ended?
}
```

### **Bill**
```rust
pub struct Bill {
    id: u64,
    cycle_id: u64,
    name: String,                // e.g., "Netflix", "Electricity"
    bill_type: BillType,         // Enum for categorization
    amount_per_occurrence: i128, // Amount per payment
    due_dates: Vec<u64>,         // All scheduled dates (recurring)
    paid_dates: Vec<u64>,        // Dates already paid
    is_emergency: bool,          // True if <30 day lead time
    is_cancelled: bool,          // True if user cancelled
    cancelled_date: u64,         // When it was cancelled
    total_amount: i128,          // amount_per_occurrence Ã— occurrences
}
```

### **BillType Enum**
```rust
pub enum BillType {
    Electricity,
    Water,
    Internet,
    Phone,
    Rent,
    Netflix,
    Spotify,
    Gym,
    Insurance,
    Other(String),  // Custom description
}
```

### **UserProfile**
```rust
pub struct UserProfile {
    wallet: Address,
    name: Option<String>,
    email: Option<String>,
    notification_preferences: NotificationPrefs,
}

pub struct NotificationPrefs {
    email_on_payment: bool,
    email_on_due_soon: bool,    // 3 days before
    email_monthly_summary: bool,
}
```

---

## ğŸ›ï¸ Smart Contract Methods

### **Cycle Management**

#### `create_cycle(start_date: u64, end_date: u64) -> u64`
- **Access:** Any user
- **Validations:**
  - start_date >= current_time
  - end_date <= start_date + 365 days (max 12 months)
  - end_date >= start_date + 30 days (min 1 month)
- **Returns:** Cycle ID
- **Events:** CycleCreated

#### `deposit_funds(cycle_id: u64, amount: i128)`
- **Access:** Cycle owner only
- **Validations:**
  - Cycle exists and not closed
  - Amount > 0
  - User has approved USDC transfer
- **Logic:**
  - Calculate operating fee (1-5% of amount)
  - Transfer fee to fee_recipient_address
  - Transfer remaining to contract
  - Update total_deposited
- **Events:** FundsDeposited

#### `close_cycle(cycle_id: u64)`
- **Access:** Cycle owner only (after end_date)
- **Validations:**
  - current_time >= end_date
  - Not already closed
- **Logic:**
  - Calculate surplus (deposited - spent)
  - Transfer surplus to owner
  - Mark cycle as closed
- **Events:** CycleClosed

---

### **Bill Management**

#### `add_bill(cycle_id: u64, bill: BillInput) -> u64`
- **Access:** Cycle owner only
- **Validations:**
  - Cycle exists and not closed
  - User hasn't exceeded monthly adjustment limit
  - All due_dates within cycle period
  - Standard bills: earliest due_date >= current_time + 30 days
  - Sufficient unallocated funds
- **Logic:**
  - Calculate total_amount (amount Ã— occurrences)
  - Update total_allocated
  - Mark adjustment as used for current month
- **Returns:** Bill ID
- **Events:** BillAdded

#### `add_emergency_bill(cycle_id: u64, bill: BillInput) -> u64`
- **Access:** Cycle owner only
- **Validations:**
  - Same as add_bill EXCEPT:
  - Due date can be < 30 days
  - Emergency bills total <= 10% of total_deposited
  - Fee is 2Ã— normal operating fee
- **Logic:** Same as add_bill but mark is_emergency = true
- **Events:** EmergencyBillAdded

#### `cancel_bill(cycle_id: u64, bill_id: u64)`
- **Access:** Cycle owner only
- **Validations:**
  - Bill exists and not already cancelled
  - Monthly adjustment available
- **Logic:**
  - Mark bill as cancelled
  - Update cancelled_date
  - Funds remain locked until end_date
  - Update total_allocated (subtract unpaid occurrences)
- **Events:** BillCancelled

#### `modify_bill_amount(cycle_id: u64, bill_id: u64, new_amount: i128)`
- **Access:** Cycle owner only
- **Validations:**
  - Bill exists and not cancelled
  - Monthly adjustment available
- **Logic:**
  - Calculate remaining occurrences (unpaid)
  - Calculate difference (new - old) Ã— remaining
  - If increase: require additional deposit
  - If decrease: funds locked until end_date
  - Update bill amount and total_allocated
- **Events:** BillModified

---

### **Payment Execution**

#### `execute_bill_payment(cycle_id: u64, bill_id: u64)`
- **Access:** Keeper service (or admin for manual trigger)
- **Validations:**
  - Bill exists and not cancelled
  - At least one due_date <= current_time
  - That occurrence not already paid
- **Logic:**
  - Find next unpaid due_date that has passed
  - Transfer amount to cycle owner's wallet
  - Add to paid_dates
  - Update total_spent
  - Set memo to bill name
- **Events:** BillPaid (includes bill_type for message selection)

#### `execute_all_due_bills(cycle_id: u64)`
- **Access:** Keeper service
- **Logic:**
  - Loop through all bills in cycle
  - Execute payment for any bill with unpaid due date <= current_time
- **Events:** MultipleBillsPaid

---

### **Admin Functions**

#### `set_admin(new_admin: Address)`
- **Access:** Current admin only
- **Logic:** Update admin address
- **Events:** AdminChanged

#### `set_fee_recipient(recipient: Address)`
- **Access:** Current admin only
- **Logic:** Update fee recipient address (defaults to admin if not set)
- **Events:** FeeRecipientChanged

#### `set_fee_percentage(new_fee: u32)`
- **Access:** Current admin only
- **Validations:**
  - new_fee >= 100 (1%)
  - new_fee <= 500 (5%)
- **Logic:** Update fee_percentage (affects NEW cycles only)
- **Events:** FeePercentageChanged

#### `withdraw_fees()`
- **Access:** Current admin only
- **Logic:** Transfer accumulated fees to fee_recipient
- **Events:** FeesWithdrawn

---

## ğŸ¨ Frontend Pages & Features

### **Landing Page (`/`)**
- Hero section with value proposition
- "Get Started" CTA â†’ Connect wallet
- Feature highlights (Time-locked, Automatic, Secure)
- Testimonials (mock for demo)

### **Dashboard (`/dashboard`)**
**Requires:** Connected wallet

**Components:**
- Welcome message (uses profile name or wallet address)
- Active cycles overview cards
- Quick stats:
  - Total locked: $X,XXX USDC
  - Bills paid this month: X
  - Next bill due: [Bill name] on [Date]
  - Total surplus expected: $XXX
- CTA buttons:
  - "Create New Cycle"
  - "View History"
- Monthly adjustment tracker:
  ```
  ğŸ“ Monthly Adjustment: Available / Used
     Next reset: Feb 1, 2025
  ```

### **Create Cycle Page (`/create-cycle`)**
**Step 1: Select Period**
- Date range picker (1-12 months)
- Visual calendar showing selected period
- Period name suggestion (e.g., "Q1 2025", "Jan-Jun 2025")

**Step 2: Add Bills (Optional)**
- Can skip and add later
- "Add Bill" button opens modal
- See "Add Bill Modal" below

**Step 3: Calculate & Deposit**
- Bills summary table
- Calculation breakdown:
  ```
  Bills total:        $10,000
  Operating fee (1%):    $100
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total to deposit:  $10,100
  ```
- Input field (allow extra amount)
- "Lock Funds" button â†’ Wallet signature
- Success confirmation

### **Cycle Detail Page (`/cycle/:id`)**
**Layout:**
- Left Sidebar (Sticky):
  - Cycle info card:
    - Period dates
    - Progress bar (time elapsed)
    - Locked amount
    - Spent / Remaining
    - Expected surplus
  - Adjustment status
  - "Add Bill" button
  - "Close Cycle" button (if ended)

- Main Content:
  - **Upcoming Bills Tab:**
    - Calendar view showing due dates
    - List view with filters
    - Each bill shows: name, amount, next due, type
    - Actions: Modify, Cancel

  - **Payment History Tab:**
    - Activity feed (most recent first)
    - Each entry shows:
      - Bill name with icon
      - Amount paid
      - Date paid
      - Funny message
      - Stellar transaction link
    - Export to CSV button

  - **Metrics Tab:**
    - Charts (paid vs remaining)
    - Monthly breakdown
    - Category breakdown (by bill type)

### **Add Bill Modal**
**Fields:**
- Bill name (text input)
- Bill type (dropdown: Electricity, Water, etc., Other)
  - If "Other" â†’ Additional description field
- Amount per occurrence (USDC input)
- Recurrence (dropdown):
  - One-time
  - Weekly
  - Monthly
  - Quarterly
  - Semi-annually
  - Custom

**Calendar Section:**
- 12-month calendar grid
- If recurrence selected â†’ Auto-fills dates
- User can check/uncheck individual dates
- Visual indicator for skipped dates
- Summary: "X occurrences selected"

**Emergency Bill Toggle:**
- Checkbox: "This is an emergency bill"
- Warning if due date < 30 days:
  ```
  âš ï¸ Emergency bills are subject to 2% fee instead of 1%
  and are limited to 10% of your cycle funds.
  ```

**Summary Footer:**
- Total cost: $XXX (amount Ã— occurrences)
- Available funds: $XXX
- Remaining after this bill: $XXX
- "Add Bill" button (disabled if insufficient funds)

### **Profile Page (`/profile`)**
- Avatar/Wallet address
- Edit profile form:
  - Name (optional)
  - Email (optional)
  - Notification preferences (checkboxes)
- Connected wallet info
- "Save Changes" button

### **History Page (`/history`)**
- List of closed cycles
- Each card shows:
  - Period
  - Total locked
  - Total spent
  - Surplus returned
  - Number of bills paid
- Click to view detailed history

---

## ğŸ”” Notification System

### **Toast Notifications (In-App)**
**Trigger:** Bill payment executed

**Content:**
```
ğŸ¬ Netflix Bill Paid!
"You deserve to chill and watch a movie on the weekends"
Amount: $15 USDC
[View Transaction]
```

**Message Pool by Bill Type:**
See BILL_MESSAGES constant in implementation

### **Email Notifications (SendGrid)**
**Types:**
1. **Bill Paid:**
   - Subject: "LockedIn: Netflix bill paid ($15)"
   - Body: Funny message + transaction link

2. **Bill Due Soon (3 days before):**
   - Subject: "LockedIn: Netflix bill due in 3 days"
   - Body: Reminder with amount

3. **Monthly Summary:**
   - Subject: "LockedIn: Your January summary"
   - Body: Bills paid, amount spent, upcoming bills

4. **Cycle Ending Soon (7 days before):**
   - Subject: "LockedIn: Your cycle ends in 7 days"
   - Body: Surplus amount, option to create new cycle

---

## âš™ï¸ Keeper Service (Cron Job)

**Technology:** Node.js + node-cron

**Schedule:** Every hour (or every 6 hours)

**Logic:**
```javascript
// Pseudo-code
async function checkAndPayBills() {
  // 1. Fetch all active cycles
  const cycles = await contract.get_active_cycles();

  // 2. For each cycle
  for (const cycle of cycles) {
    // 3. Check for due bills
    const dueBills = await contract.get_due_bills(cycle.id);

    // 4. Execute payments
    for (const bill of dueBills) {
      await contract.execute_bill_payment(cycle.id, bill.id);

      // 5. Send notifications
      await sendEmailNotification(cycle.owner, bill);
    }
  }
}
```

**Manual Trigger:**
Admin dashboard button that calls the same function immediately

---

## ğŸ¯ 4-Day Implementation Plan

### **Day 1: Smart Contract Foundation**
**Morning (4 hours):**
- âœ… Set up contract structure
- âœ… Implement data structures
- âœ… Create cycle management functions
- âœ… Access control setup

**Afternoon (4 hours):**
- âœ… Implement bill management functions
- âœ… Add time-lock validation logic
- âœ… Emergency bill handling
- âœ… Unit tests for core functions

**Evening (2 hours):**
- âœ… Deploy to testnet
- âœ… Verify TypeScript client generation
- âœ… Test basic flows via CLI

---

### **Day 2: Frontend Foundation**
**Morning (4 hours):**
- âœ… Set up routing
- âœ… Connect wallet integration
- âœ… Dashboard layout
- âœ… Fetch and display cycles

**Afternoon (4 hours):**
- âœ… Create cycle flow (Steps 1-3)
- âœ… USDC deposit integration
- âœ… Basic bill list display
- âœ… Cycle detail page layout

**Evening (2 hours):**
- âœ… Profile setup
- âœ… Notification preferences
- âœ… Test end-to-end cycle creation

---

### **Day 3: Core Features**
**Morning (4 hours):**
- âœ… Add bill modal with calendar
- âœ… Recurring bill logic
- âœ… Bill modification/cancellation
- âœ… Monthly adjustment tracking

**Afternoon (4 hours):**
- âœ… Payment execution integration
- âœ… Activity feed with messages
- âœ… Bill history display
- âœ… Metrics and charts

**Evening (2 hours):**
- âœ… Keeper service setup
- âœ… Manual trigger for demo
- âœ… SendGrid integration basics

---

### **Day 4: Polish & Demo**
**Morning (4 hours):**
- âœ… Funny messages implementation
- âœ… Error handling and validations
- âœ… UI polish and responsive design
- âœ… Loading states and spinners

**Afternoon (3 hours):**
- âœ… Demo script preparation
- âœ… Create test data and scenarios
- âœ… Practice presentation
- âœ… Record demo video

**Evening (1 hour):**
- âœ… Final testing
- âœ… Deploy frontend
- âœ… Update README with demo instructions

---

## ğŸ¬ Demo Script (5 minutes)

**Act 1: The Problem (30 seconds)**
"Raise your hand if you've ever missed a bill payment. Or stressed about managing multiple subscriptions? With LockedIn, those worries are gone."

**Act 2: The Solution (3 minutes)**

**Scene 1: Create Cycle (45 sec)**
- "Watch how easy it is"
- Select period: Jan 1 - Dec 31
- "I'm locking funds for the entire year"

**Scene 2: Add Bills (60 sec)**
- Add Netflix ($15/month) - select all 12 months
- Add Electricity ($80/month) - skip June, July (vacation)
- Add Rent ($1200/month) - all 12 months
- Show calculation: $18,040 total + $180 fee

**Scene 3: Payment Execution (45 sec)**
- "Bills get paid automatically"
- Trigger Netflix payment manually
- Toast appears with funny message
- Show transaction on Stellar
- Activity feed updates

**Scene 4: Discipline & Control (30 sec)**
- Try to withdraw early â†’ Blocked
- "Can't withdraw until bills are due - that's discipline"
- Show surplus calculation
- "At year end, I get $500 back"

**Act 3: The Tech (90 seconds)**
"Built in 4 days with Scaffold Stellar:
- Smart contract in Rust
- Auto-generated TypeScript client
- React frontend
- All deployed and live on Stellar testnet"

"LockedIn: Get locked in to financial discipline. Thank you!"

---

## ğŸ“ Security Checklist

Before deploying:
- [ ] All admin functions have require_admin check
- [ ] All owner-only functions verify ownership
- [ ] Integer overflow checks (Rust default)
- [ ] Time validation on all date inputs
- [ ] Amount validation (no negative numbers)
- [ ] Fee percentage bounds enforced
- [ ] Emergency bill limit enforced
- [ ] Monthly adjustment limit enforced
- [ ] No reentrancy vulnerabilities
- [ ] Events emitted for all state changes
- [ ] USDC transfer checks (approve/transfer)
- [ ] Cycle closure checks (prevent double-withdrawal)

---

## ğŸš€ Deployment Configuration

### **environments.toml**
```toml
[testnet]
network = "testnet"

[[testnet.accounts]]
name = "deployer"
funded = true

[[testnet.contracts]]
name = "lockedin"
wasm = "target/stellar/release/lockedin.wasm"
deploy = true

[testnet.contracts.constructor]
admin = "$deployer"
fee_percentage = 100  # 1%
```

### **.env**
```env
STELLAR_SCAFFOLD_ENV=testnet
PUBLIC_STELLAR_NETWORK=TESTNET
PUBLIC_STELLAR_NETWORK_PASSPHRASE="Test SDF Network ; September 2015"
PUBLIC_STELLAR_RPC_URL="https://soroban-testnet.stellar.org"
PUBLIC_STELLAR_HORIZON_URL="https://horizon-testnet.stellar.org"

# Admin wallet (deployer)
ADMIN_WALLET_ADDRESS=GXXXXXX...

# SendGrid
SENDGRID_API_KEY=SG.xxxxx...
NOTIFICATION_EMAIL_FROM=noreply@lockedin.app

# Keeper service
KEEPER_CRON_SCHEDULE="0 */6 * * *"  # Every 6 hours
```

---

## ğŸ”® Future Enhancements (Post-Hackathon)

### **V2 Features:**
- [ ] Liquidity pool integration (yield farming)
- [ ] Multi-currency support (USDT, EURC)
- [ ] Bill recipient payment (direct payment to providers)
- [ ] Shared cycles (family/team bill splitting)
- [ ] Bill templates (save common bill sets)
- [ ] Analytics dashboard (spending insights)
- [ ] Mobile app (React Native)
- [ ] Mainnet deployment

### **Liquidity Pool Design (For Later):**
**Architecture:**
```rust
pub struct YieldStrategy {
    pool_address: Address,      // Soroswap USDC/USDT pool
    deposited_amount: i128,     // Amount in pool
    shares: i128,               // LP tokens held
    estimated_apy: u32,         // e.g., 500 = 5%
}

// Methods:
deposit_to_pool(cycle_id, amount)
withdraw_from_pool(cycle_id, amount)
claim_yield(cycle_id)
```

**Conditions:**
- Only for cycles >= 6 months
- Only for amounts >= $5,000
- USDC/USDT pool only (minimize impermanent loss)
- User must opt-in

---

## ğŸ“„ README Template

```markdown
# LockedIn ğŸ”’

**Get LockedIn to financial discipline**

LockedIn is a smart contract-based bill payment system on Stellar that helps you never miss a bill payment through time-locked funds and automatic scheduling.

## Features
- ğŸ” Time-locked savings (1-12 months)
- ğŸ“… Automatic bill scheduling
- ğŸ’° USDC-based payments
- ğŸ“Š Visual dashboard with metrics
- ğŸ”” Email notifications
- ğŸ‰ Funny payment messages

## Quick Start
[Installation and usage instructions]

## Demo
[Link to video demo]

## Built With
- Stellar Soroban (Smart Contracts)
- Scaffold Stellar (Development Framework)
- React + TypeScript (Frontend)
- SendGrid (Notifications)

## Hackathon Submission
Built in 4 days for [Hackathon Name]

## License
MIT
```

---

## ğŸ“ Support & Feedback

**During Development:**
- Use this spec as source of truth
- Update as we make decisions
- Add notes/questions in comments

**Questions?**
- Raise them before implementing
- Document decisions made
- Keep spec synchronized with code

---

**Last Updated:** [Date]
**Status:** Ready to build
**Next Step:** Begin Day 1 - Smart Contract Foundation
